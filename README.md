# 智能循迹车

## 项目概述

本项目是一款基于STM32F10x微控制器的智能循迹小车，能够自动沿黑线轨道行驶。通过灰度传感器检测黑线位置，结合舵机转向和电机控制，实现了自动循迹功能。

## 硬件组成

- 主控：STM32F10x系列微控制器
- 传感器：5个灰度传感器（用于检测黑线）
- 执行器：
  - 舵机（控制转向）
  - 直流电机（驱动车轮）
- 电源系统

## 软件功能

### 主要功能

- 黑线检测与跟踪
- 自适应转向控制
- 速度动态调整
- 定时器中断处理

### 控制策略

循迹车采用了分级转向控制策略：
- 小角度转向（smallTurn）：轻微偏离时的修正
- 中角度转向（middleTurn）：中等偏离时的修正
- 大角度转向（bigTurn）：严重偏离时的修正

根据传感器状态，系统会动态调整左右电机速度和舵机角度，确保车辆能够平稳地沿黑线行驶。

## 代码结构

- `main.c`：主程序，包含循迹算法和控制逻辑
- `Delay.h`：延时函数
- `Motor.h`：电机控制
- `Sensor.h`：传感器读取
- `Servo.h`：舵机控制
- `PWM.h`：PWM信号生成
- `Serial.h`：串口通信

## 关键参数

```c
#define smallTurn 18    // 小角度转向值
#define middleTurn 45   // 中角度转向值
#define bigTurn 85      // 大角度转向值

#define MAX_SPEED 1100  // 最大速度
#define MIN_SPEED 600   // 最小速度
```

## 工作原理

1. 初始化所有外设和控制参数
2. 循环读取5个灰度传感器的状态
3. 根据传感器状态计算当前位置偏差
4. 根据偏差调整舵机角度和左右电机速度
5. 实现闭环控制，保持车辆沿黑线行驶

## 状态转换逻辑

系统使用Flag变量记录当前转向状态：
- Flag = 0：直线行驶
- Flag = 1：小幅度转向
- Flag = 2：中幅度转向
- Flag = 3：大幅度转向

根据当前状态和传感器读数，系统决定下一步的转向策略，实现平滑的路径跟踪。

## 使用说明

1. 将代码烧录到STM32F10x微控制器
2. 将小车放置在黑线轨道上
3. 上电后，小车将自动开始循迹
4. 当检测到特定条件（多个传感器同时检测到黑线且时间超过阈值）时，小车将自动停止

## 开发环境

- IDE：Keil MDK
- 编程语言：C
- 目标平台：STM32F10x系列微控制器

## 联系方式

[1816054322@qq.com]
